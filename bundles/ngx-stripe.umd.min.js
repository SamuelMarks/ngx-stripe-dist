!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs/internal/BehaviorSubject"),require("rxjs/operators"),require("rxjs/internal-compatibility"),require("rxjs"),require("rxjs/internal/observable/combineLatest"),require("rxjs/add/observable/combineLatest"),require("rxjs/add/observable/fromPromise"),require("rxjs/add/observable/of"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/first"),require("rxjs/add/operator/map")):"function"==typeof define&&define.amd?define("ngx-stripe",["exports","@angular/core","@angular/common","rxjs/internal/BehaviorSubject","rxjs/operators","rxjs/internal-compatibility","rxjs","rxjs/internal/observable/combineLatest","rxjs/add/observable/combineLatest","rxjs/add/observable/fromPromise","rxjs/add/observable/of","rxjs/add/operator/switchMap","rxjs/add/operator/filter","rxjs/add/operator/first","rxjs/add/operator/map"],t):t(e["ngx-stripe"]={},e.ng.core,e.ng.common,e.BehaviorSubject,e.Rx.Observable.prototype,e.Rx,e.rxjs,e.combineLatest)}(this,function(e,t,n,i,s,o,r,a){"use strict";function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return s}var p=function(){function e(e){this.platformId=e}return e.prototype.getNativeWindow=function(){return n.isPlatformBrowser(this.platformId)?window:{}},e}();p.decorators=[{type:t.Injectable}],p.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]};var c=function(){function e(e){this.platformId=e}return e.prototype.getNativeDocument=function(){return n.isPlatformBrowser(this.platformId)?document:{}},e}();c.decorators=[{type:t.Injectable}],c.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]}]};var l=function(){function e(e,t,r){this.platformId=e,this.window=t,this.document=r,this.status=new i.BehaviorSubject({error:!1,loaded:!1,loading:!1})}return e.prototype.asStream=function(){return this.load(),this.status.asObservable()},e.prototype.isReady=function(){return this.status.getValue().loaded},e.prototype.load=function(){var e=this;if(!n.isPlatformServer(this.platformId)){var t=this.status.getValue();if(this.window.getNativeWindow().hasOwnProperty("Stripe"))this.status.next({error:!1,loaded:!0,loading:!1});else if(!t.loaded&&!t.loading){this.status.next(Object.assign({},t,{loading:!0}));var r=this.document.getNativeDocument().createElement("script");r.type="text/javascript",r.async=!0,r.defer=!0,r.src="https://js.stripe.com/v3/",r.onload=function(){e.status.next({error:!1,loaded:!0,loading:!1})},r.onerror=function(){e.status.next({error:!0,loaded:!1,loading:!1})},this.document.getNativeDocument().body.appendChild(r)}}},e}();l.decorators=[{type:t.Injectable}],l.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:p},{type:c}]};var d=new t.InjectionToken("Stripe Publishable Key"),f=new t.InjectionToken("Stripe Options");function h(e){return"type"in e}function y(e){return"bank_account"===e}function m(e){return"country"in e&&"currency"in e&&"routing_number"in e&&"account_number"in e&&"account_holder_name"in e&&"account_holder_type"in e&&("individual"===e.account_holder_type||"company"===e.account_holder_type)}function b(e){return"pii"===e}function v(e){return"personal_id_number"in e}var j=function(){function e(e,t,r,n){var o=this;this.loader=e,this.window=t,this.key=r,this.options=n,this.stripe$=new i.BehaviorSubject(undefined),this.loader.asStream().pipe(s.filter(function(e){return!0===e.loaded}),s.first(),s.map(function(){return o.window.getNativeWindow().Stripe})).subscribe(function(e){var t=o.options?e(o.key,o.options):e(o.key);o.stripe$.next(t)})}return e.prototype.getInstance=function(){return this.stripe$.getValue()},e.prototype.elements=function(t){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.map(function(e){return e.elements(t)}),s.first())},e.prototype.createToken=function(r,n){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return y(r)&&m(n)||b(r)&&v(n),o.fromPromise(t.createToken(r,n))}),s.first())},e.prototype.createSource=function(r,n){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return h(r)?o.fromPromise(t.createSource(r)):o.fromPromise(t.createSource(r,n))}),s.first())},e.prototype.retrieveSource=function(r){return this.stripe$.asObservable().pipe(s.filter(function(e){return Boolean(e)}),s.switchMap(function(e){var t=e;return o.fromPromise(t.retrieveSource(r))}),s.first())},e.prototype.paymentRequest=function(e){var t=this.getInstance();return t?t.paymentRequest(e):undefined},e}(),g=function(){function e(e,t,r,n){this.key=e,this.options=t,this.loader=r,this.window=n,this.stripe=null,e&&(this.stripe=new j(this.loader,this.window,e,t))}return e.prototype.getStripeReference=function(){var e=this;return this.loader.asStream().pipe(s.filter(function(e){return!0===e.loaded}),s.map(function(){return e.window.getNativeWindow().Stripe}))},e.prototype.getInstance=function(){return null==this.stripe?this.stripe:this.stripe.getInstance()},e.prototype.setKey=function(e,t){return this.changeKey(e,t)},e.prototype.changeKey=function(e,t){return this.stripe=new j(this.loader,this.window,e,t),this.stripe},e.prototype.elements=function(e){return null==this.stripe?new r.Observable:this.stripe.elements(e)},e.prototype.createToken=function(e,t){return null==this.stripe?new r.Observable:this.stripe.createToken(e,t)},e.prototype.createSource=function(e,t){return null==this.stripe?new r.Observable:this.stripe.createSource(e,t)},e.prototype.retrieveSource=function(e){return null==this.stripe?new r.Observable:this.stripe.retrieveSource(e)},e.prototype.paymentRequest=function(e){if(null!=this.stripe)return this.stripe.paymentRequest(e)},e}();g.decorators=[{type:t.Injectable}],g.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[d]}]},{type:undefined,decorators:[{type:t.Inject,args:[f]}]},{type:l},{type:p}]};var w=function(){function e(e,t,r,n){this.baseKey=e,this.baseOptions=t,this.loader=r,this.window=n}return e.prototype.create=function(e,t){return new j(this.loader,this.window,e,t)},e}();w.decorators=[{type:t.Injectable}],w.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[d]}]},{type:undefined,decorators:[{type:t.Inject,args:[f]}]},{type:l},{type:p}]};var x=function(){function e(e){this.stripeService=e,this.card=new t.EventEmitter,this.on=new t.EventEmitter,this.element=null,this.options$=new i.BehaviorSubject({}),this.elementsOptions$=new i.BehaviorSubject({}),this.stripe$=new i.BehaviorSubject(null)}return Object.defineProperty(e.prototype,"options",{set:function(e){this.options$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementsOptions",{set:function(e){this.elementsOptions$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stripe",{set:function(e){this.stripe$.next(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var o=this,e=a.combineLatest(this.elementsOptions$.asObservable(),this.stripe$.asObservable()).pipe(s.switchMap(function(e){var t=u(e,2),r=t[0],n=t[1];return n?0<Object.keys(r).length?n.elements(r):n.elements():0<Object.keys(r).length?o.stripeService.elements(r):o.stripeService.elements()}));a.combineLatest(e,this.options$.asObservable().pipe(s.filter(function(e){return Boolean(e)}))).subscribe(function(e){var t=u(e,2),r=t[0],n=t[1];o.element=r.create("card",n),o.element.on("blur",function(e){return o.on.emit({event:e,type:"blur"})}),o.element.on("change",function(e){return o.on.emit({event:e,type:"change"})}),o.element.on("click",function(e){return o.on.emit({event:e,type:"click"})}),o.element.on("focus",function(e){return o.on.emit({event:e,type:"focus"})}),o.element.on("ready",function(e){return o.on.emit({event:e,type:"ready"})}),null!=o.stripeCard&&o.element.mount(o.stripeCard.nativeElement),o.card.emit(o.element)})},e.prototype.getCard=function(){return this.element},e}();x.decorators=[{type:t.Component,args:[{selector:"ngx-stripe-card",template:'\n    <div class="field" #stripeCard></div>\n  '}]}],x.ctorParameters=function(){return[{type:g}]},x.propDecorators={card:[{type:t.Output}],on:[{type:t.Output}],stripeCard:[{type:t.ViewChild,args:["stripeCard"]}],options:[{type:t.Input}],elementsOptions:[{type:t.Input}],stripe:[{type:t.Input}]};var S=function(){function r(){}return r.forRoot=function(e,t){return{ngModule:r,providers:[l,g,w,p,c,{provide:d,useValue:e},{provide:f,useValue:t}]}},r}();S.decorators=[{type:t.NgModule,args:[{declarations:[x],exports:[x]}]}],e.NgxStripeModule=S,e.StripeCardComponent=x,e.StripeService=g,e.StripeFactoryService=w,e.StripeInstance=j,e.LazyStripeAPILoader=l,e.WindowRef=p,e.DocumentRef=c,e.isSourceData=h,e.STRIPE_PUBLISHABLE_KEY=d,e.STRIPE_OPTIONS=f,e.isBankAccount=y,e.isBankAccountData=m,e.isPii=b,e.isPiiData=v,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-stripe.umd.min.js.map
